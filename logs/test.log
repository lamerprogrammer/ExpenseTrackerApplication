14:57:08.591 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.3.Final
14:57:08.663 [main] INFO  test.controller.AdminControllerIT - Starting AdminControllerIT using Java 17.0.16 with PID 17028 (started by lamer in C:\Users\lamer\IdeaProjects\expense-tracker)
14:57:08.664 [main] INFO  test.controller.AdminControllerIT - The following 1 profile is active: "test"
14:57:09.520 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
14:57:09.522 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Elasticsearch repositories in DEFAULT mode.
14:57:09.555 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Elasticsearch - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.logging.audit.AuditRepository; If you want this repository to be a Elasticsearch repository, consider annotating your entities with one of these annotations: org.springframework.data.elasticsearch.annotations.Document (preferred), or consider extending one of the following types with your repository: org.springframework.data.elasticsearch.repository.ElasticsearchRepository
14:57:09.555 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Elasticsearch - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.repository.CategoryRepository; If you want this repository to be a Elasticsearch repository, consider annotating your entities with one of these annotations: org.springframework.data.elasticsearch.annotations.Document (preferred), or consider extending one of the following types with your repository: org.springframework.data.elasticsearch.repository.ElasticsearchRepository
14:57:09.555 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Elasticsearch - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.repository.ExpenseRepository; If you want this repository to be a Elasticsearch repository, consider annotating your entities with one of these annotations: org.springframework.data.elasticsearch.annotations.Document (preferred), or consider extending one of the following types with your repository: org.springframework.data.elasticsearch.repository.ElasticsearchRepository
14:57:09.556 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Elasticsearch - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.repository.RecurringTransactionRepository; If you want this repository to be a Elasticsearch repository, consider annotating your entities with one of these annotations: org.springframework.data.elasticsearch.annotations.Document (preferred), or consider extending one of the following types with your repository: org.springframework.data.elasticsearch.repository.ElasticsearchRepository
14:57:09.556 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Elasticsearch - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.repository.UserRepository; If you want this repository to be a Elasticsearch repository, consider annotating your entities with one of these annotations: org.springframework.data.elasticsearch.annotations.Document (preferred), or consider extending one of the following types with your repository: org.springframework.data.elasticsearch.repository.ElasticsearchRepository
14:57:09.568 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 41 ms. Found 1 Elasticsearch repository interface.
14:57:09.575 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
14:57:09.576 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14:57:09.584 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data JPA - Could not safely identify store assignment for repository candidate interface com.example.expensetracker.logging.applog.AppLogRepository; If you want this repository to be a JPA repository, consider annotating your entities with one of these annotations: jakarta.persistence.Entity, jakarta.persistence.MappedSuperclass (preferred), or consider extending one of the following types with your repository: org.springframework.data.jpa.repository.JpaRepository
14:57:09.590 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 5 JPA repository interfaces.
14:57:10.201 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 0 (http)
14:57:10.210 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-auto-1"]
14:57:10.211 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
14:57:10.212 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.44]
14:57:10.254 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
14:57:10.254 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1577 ms
14:57:10.764 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
14:57:10.900 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@2f308931
14:57:10.901 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
14:57:11.029 [main] INFO  liquibase.database - Set default schema name to public
14:57:11.114 [main] INFO  liquibase.ui - INFO: The drop-all command may result in unrecoverable destructive changes to objects at 'jdbc:postgresql://localhost:5432/expense_tracker'.
To protect against unwanted drops, set --requireForce=true, which will require a --force=true flag on the command.
Learn more at https://docs.liquibase.com/dropall.

14:57:11.182 [main] INFO  liquibase.lockservice - Successfully acquired change log lock
14:57:11.188 [main] INFO  liquibase.command - Dropping Database Objects in schema: expense_tracker.public
14:57:11.192 [main] INFO  liquibase.snapshot - Creating snapshot
14:57:11.320 [main] WARN  liquibase.executor - drop cascades to 2 other objects
14:57:11.326 [main] WARN  liquibase.executor - drop cascades to 4 other objects
14:57:11.558 [main] INFO  liquibase.database - Successfully deleted all supported object types in schema expense_tracker.public.
14:57:11.563 [main] INFO  liquibase.snapshot - Creating snapshot
14:57:11.566 [main] WARN  liquibase.lockservice - Failed to release change log lock
14:57:11.569 [main] INFO  liquibase.snapshot - Creating snapshot
14:57:11.572 [main] INFO  liquibase.ui - All objects dropped from postgres@jdbc:postgresql://localhost:5432/expense_tracker
14:57:11.573 [main] INFO  liquibase.command - Command execution complete
14:57:12.327 [main] INFO  liquibase.changelog - Creating database history table with name: public.databasechangelog
14:57:12.344 [main] INFO  liquibase.changelog - Reading from public.databasechangelog
14:57:12.383 [main] INFO  liquibase.snapshot - Creating snapshot
14:57:12.466 [main] INFO  liquibase.lockservice - Successfully acquired change log lock
14:57:12.467 [main] INFO  liquibase.command - Using deploymentId: 1739030750
14:57:12.468 [main] INFO  liquibase.changelog - Reading from public.databasechangelog
14:57:12.485 [main] INFO  liquibase.ui - Running Changeset: db/changelog/001-create-users.xml::000-create-users::lamer
14:57:12.496 [main] INFO  liquibase.changelog - Table users created
14:57:12.498 [main] INFO  liquibase.changelog - Table user_roles created
14:57:12.500 [main] INFO  liquibase.changelog - Primary key added to user_roles (user_id, role)
14:57:12.501 [main] INFO  liquibase.changelog - Foreign key constraint added to user_roles (user_id)
14:57:12.503 [main] INFO  liquibase.changelog - ChangeSet db/changelog/001-create-users.xml::000-create-users::lamer ran successfully in 17ms
14:57:12.508 [main] INFO  liquibase.ui - Running Changeset: db/changelog/002-add-audit-table.xml::002-add-audit-table::lamer
14:57:12.512 [main] INFO  liquibase.changelog - Table admin_audit created
14:57:12.513 [main] INFO  liquibase.changelog - Foreign key constraint added to admin_audit (target_user_id)
14:57:12.514 [main] INFO  liquibase.changelog - Foreign key constraint added to admin_audit (performed_by)
14:57:12.515 [main] INFO  liquibase.changelog - ChangeSet db/changelog/002-add-audit-table.xml::002-add-audit-table::lamer ran successfully in 7ms
14:57:12.518 [main] INFO  liquibase.ui - Running Changeset: db/changelog/003-create-categories-table.xml::005-create-categories-table::lamer
14:57:12.525 [main] INFO  liquibase.changelog - Table categories created
14:57:12.526 [main] INFO  liquibase.changelog - ChangeSet db/changelog/003-create-categories-table.xml::005-create-categories-table::lamer ran successfully in 8ms
14:57:12.529 [main] INFO  liquibase.ui - Running Changeset: db/changelog/004-create-expenses-table.xml.xml::003-expenses-table::lamer
14:57:12.535 [main] INFO  liquibase.changelog - Table expenses created
14:57:12.536 [main] INFO  liquibase.changelog - Foreign key constraint added to expenses (user_id)
14:57:12.537 [main] INFO  liquibase.changelog - Foreign key constraint added to expenses (category_id)
14:57:12.538 [main] INFO  liquibase.changelog - ChangeSet db/changelog/004-create-expenses-table.xml.xml::003-expenses-table::lamer ran successfully in 9ms
14:57:12.540 [main] INFO  liquibase.ui - Running Changeset: db/changelog/005-add-deleted-total-expenses.xml::004-add-deleted-total-expenses::lamer
14:57:12.543 [main] INFO  liquibase.changelog - Columns deleted(boolean),total_expenses(numeric(19,2)) added to users
14:57:12.544 [main] INFO  liquibase.changelog - ChangeSet db/changelog/005-add-deleted-total-expenses.xml::004-add-deleted-total-expenses::lamer ran successfully in 4ms
14:57:12.547 [main] INFO  liquibase.ui - Running Changeset: db/changelog/006-create-recurring-transactions-table.xml::006-create-recurring_transactions-table::lamer
14:57:12.553 [main] INFO  liquibase.changelog - Table recurring_transactions created
14:57:12.554 [main] INFO  liquibase.changelog - Foreign key constraint added to recurring_transactions (user_id)
14:57:12.555 [main] INFO  liquibase.changelog - Foreign key constraint added to recurring_transactions (category_id)
14:57:12.556 [main] INFO  liquibase.changelog - ChangeSet db/changelog/006-create-recurring-transactions-table.xml::006-create-recurring_transactions-table::lamer ran successfully in 9ms
14:57:12.562 [main] INFO  liquibase.util - UPDATE SUMMARY
14:57:12.562 [main] INFO  liquibase.util - Run:                          6
14:57:12.562 [main] INFO  liquibase.util - Previously run:               0
14:57:12.562 [main] INFO  liquibase.util - Filtered out:                 0
14:57:12.562 [main] INFO  liquibase.util - -------------------------------
14:57:12.562 [main] INFO  liquibase.util - Total change sets:            6
14:57:12.563 [main] INFO  liquibase.util - Update summary generated
14:57:12.564 [main] INFO  liquibase.command - Update command completed successfully.
14:57:12.564 [main] INFO  liquibase.ui - Liquibase: Update has been successful. Rows affected: 6
14:57:12.567 [main] INFO  liquibase.lockservice - Successfully released change log lock
14:57:12.567 [main] INFO  liquibase.command - Command execution complete
14:57:12.626 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
14:57:12.682 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.6.26.Final
14:57:12.709 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
14:57:12.927 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
14:57:12.967 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
14:57:12.981 [main] INFO  o.hibernate.orm.connections.pooling - HHH10001005: Database info:
	Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
	Database driver: undefined/unknown
	Database version: 15.14
	Autocommit mode: undefined/unknown
	Isolation level: undefined/unknown
	Minimum pool size: undefined/unknown
	Maximum pool size: undefined/unknown
14:57:13.718 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
14:57:13.720 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
14:57:13.862 [main] DEBUG c.e.e.security.JwtAuthFilter - Filter 'jwtAuthFilter' configured for use
14:57:13.862 [main] DEBUG c.e.e.logging.applog.AppLogFilter - Filter 'appLogFilter' configured for use
14:57:13.987 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
14:57:14.773 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14:57:14.836 [main] INFO  o.s.s.c.a.a.c.InitializeUserDetailsBeanManagerConfigurer$InitializeUserDetailsManagerConfigurer - Global AuthenticationManager configured with UserDetailsService bean with name customUserDetailsService
14:57:15.097 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - 34 mappings in 'requestMappingHandlerMapping'
14:57:15.227 [main] DEBUG o.s.w.s.h.SimpleUrlHandlerMapping - Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHandlerMapping'
14:57:15.315 [main] DEBUG o.s.s.web.DefaultSecurityFilterChain - Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, SecurityContextHolderFilter, HeaderWriterFilter, LogoutFilter, JwtAuthFilter, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, SessionManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
14:57:15.394 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerAdapter - ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvice
14:57:15.446 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 3 @ExceptionHandler, 1 ResponseBodyAdvice
14:57:15.465 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - ControllerAdvice beans: 3 @ExceptionHandler, 0 ResponseBodyAdvice
14:57:15.680 [main] DEBUG c.e.e.logging.applog.AppLogFilter - Filter 'appLogFilter' configured for use
14:57:15.680 [main] DEBUG c.e.e.security.JwtAuthFilter - Filter 'jwtAuthFilter' configured for use
14:57:15.681 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring TestDispatcherServlet ''
14:57:15.681 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
14:57:15.681 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 0 ms
14:57:15.729 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-auto-1"]
14:57:15.739 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 54399 (http) with context path '/'
14:57:15.748 [main] INFO  test.controller.AdminControllerIT - Started AdminControllerIT in 7.435 seconds (process running for 8.809)
14:57:16.126 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:16.130 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:16.130 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.132 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:16.135 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.181 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='not-email', password=****}]
14:57:16.212 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:16.212 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/moderator errors=[Некорректная почта]
14:57:16.218 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:16.219 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5550e9b6]
14:57:16.228 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'email': rejected value [not-email]; codes [Email.registerDto.email,Email.email,Email.java.lang.String,Email]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.email,email]; arguments []; default message [email],[Ljakarta.validation.constraints.Pattern$Flag;@2ac3cc26,.*]; default message [Некорректная почта]] ]
14:57:16.405 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:16.405 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:16.405 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.405 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:16.405 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.406 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='', password=****}]
14:57:16.407 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:16.407 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/moderator errors=[Почта обязательна]
14:57:16.407 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:16.407 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@141287d3]
14:57:16.408 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'email': rejected value []; codes [NotBlank.registerDto.email,NotBlank.email,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.email,email]; arguments []; default message [email]]; default message [Почта обязательна]] ]
14:57:16.479 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:16.480 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:16.480 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.480 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:16.480 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.481 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='not-email', password=****}]
14:57:16.481 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:16.481 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/administrator errors=[Некорректная почта]
14:57:16.482 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:16.482 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3483b696]
14:57:16.482 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'email': rejected value [not-email]; codes [Email.registerDto.email,Email.email,Email.java.lang.String,Email]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.email,email]; arguments []; default message [email],[Ljakarta.validation.constraints.Pattern$Flag;@2ac3cc26,.*]; default message [Некорректная почта]] ]
14:57:16.553 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:16.553 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:16.554 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.554 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:16.554 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.555 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='', password=****}]
14:57:16.555 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:16.556 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/administrator errors=[Почта обязательна]
14:57:16.556 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:16.556 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3671bc1b]
14:57:16.556 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'email': rejected value []; codes [NotBlank.registerDto.email,NotBlank.email,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.email,email]; arguments []; default message [email]]; default message [Почта обязательна]] ]
14:57:16.660 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:16.699 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.700 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.705 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:16.706 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:16.706 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.706 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:16.706 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.707 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='7cd2bd58-8914-462f-a662-1e1446cb97f3@example.com', password=**** (truncated)...]
14:57:16.708 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.715 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.780 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:16.795 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:16.801 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:16.858 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:16.860 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:16.862 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.862 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.869 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:16.869 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@349470c1]
14:57:16.888 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:16.888 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:16.888 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.888 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:16.888 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:16.889 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='7cd2bd58-8914-462f-a662-1e1446cb97f3@example.com', password=**** (truncated)...]
14:57:16.889 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.889 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.890 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:16.891 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:16.892 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:16.895 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityExists(EntityExistsException, HttpServletRequest)
14:57:16.909 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/create/moderator message: Сущность уже есть
14:57:16.909 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:16.909 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@4ab97f17]
14:57:16.910 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityExistsException: Эта почта уже используется.]
14:57:16.982 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:16.983 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.984 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:16.987 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/3/ban
14:57:16.987 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/3/ban
14:57:16.987 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:16.988 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/3/ban
14:57:16.988 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:16.989 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.989 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:16.990 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:16.992 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:16.993 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleIllegalArgument(IllegalArgumentException, HttpServletRequest)
14:57:17.015 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/3/ban message: Некорректный запрос
14:57:17.016 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.016 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3f42ce12]
14:57:17.016 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.IllegalArgumentException: Нельзя выполнить действие над самим собой]
14:57:17.186 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.188 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.189 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.192 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/99999/ban
14:57:17.193 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999/ban
14:57:17.193 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.193 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/99999/ban
14:57:17.193 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:17.193 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.194 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.195 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:17.196 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:17.204 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:17.206 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:17.221 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999/ban message: Запрошенный ресурс не найден
14:57:17.222 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.222 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@75ef7ab4]
14:57:17.222 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:17.292 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:17.293 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:17.293 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.293 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:17.294 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.294 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='', email='6f9e01fc-a707-49d1-9d5c-ed87b42699c2@example.com', password=****}]
14:57:17.295 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:17.295 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/moderator errors=[Имя пользователя не может быть пустым]
14:57:17.295 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.295 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@42d07888]
14:57:17.296 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'name': rejected value []; codes [NotBlank.registerDto.name,NotBlank.name,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.name,name]; arguments []; default message [name]]; default message [Имя пользователя не может быть пустым]] ]
14:57:17.383 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/users/99999
14:57:17.383 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999
14:57:17.383 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.383 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/users/99999
14:57:17.383 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#getUserById(long, HttpServletRequest)
14:57:17.384 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.384 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.386 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:17.389 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleUserNotFoundById(UserNotFoundByIdException, HttpServletRequest)
14:57:17.405 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999 message: Пользователь не найден
14:57:17.405 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.405 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@22dccfad]
14:57:17.406 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [com.example.expensetracker.exception.UserNotFoundByIdException: Пользователь с ID 99999 не найден]
14:57:17.484 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.485 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.486 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.489 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:17.489 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:17.489 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.489 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:17.489 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.490 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='69da1491-b714-40b2-9a0e-64217e63a87c@example.com', password=**** (truncated)...]
14:57:17.490 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.491 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.492 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:17.493 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:17.495 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:17.544 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.546 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:17.547 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.547 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.550 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:17.550 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@713614b0]
14:57:17.568 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:17.674 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.676 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.677 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.679 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:17.679 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:17.679 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.680 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:17.680 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.680 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='e92b72d7-cab8-4e1b-8fe8-f8364dc11a50@example.com', password=**** (truncated)...]
14:57:17.681 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.681 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.682 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:17.683 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:17.684 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:17.737 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.738 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:17.740 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.741 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.743 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:17.743 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@283f8bf]
14:57:17.759 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:17.759 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:17.760 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.760 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:17.760 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.760 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='e92b72d7-cab8-4e1b-8fe8-f8364dc11a50@example.com', password=**** (truncated)...]
14:57:17.760 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.761 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.762 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:17.763 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:17.764 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:17.765 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityExists(EntityExistsException, HttpServletRequest)
14:57:17.778 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/create/administrator message: Сущность уже есть
14:57:17.778 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.778 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@71f40da3]
14:57:17.778 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityExistsException: Эта почта уже используется.]
14:57:17.845 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.846 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.846 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.848 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:17.849 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:17.852 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/10/demote
14:57:17.852 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/10/demote
14:57:17.852 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.852 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/10/demote
14:57:17.853 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#demoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:17.853 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.853 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:17.854 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:17.855 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:17.856 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:17.858 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:17.858 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5c00caf0]
14:57:17.923 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:17.923 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:17.923 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.923 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:17.924 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.924 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='56d7bbd0-9028-4f36-b6bb-f6e77cb5c1a2@example.com', password=**** (truncated)...]
14:57:17.924 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:17.924 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/administrator errors=[Пароль обязателен]
14:57:17.925 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.925 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@dac3aeb]
14:57:17.925 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'password': rejected value []; codes [NotBlank.registerDto.password,NotBlank.password,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.password,password]; arguments []; default message [password]]; default message [Пароль обязателен]] ]
14:57:17.990 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:17.990 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:17.990 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:17.990 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:17.990 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:17.991 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='51f9b332-57a0-444f-a56c-1a8f1bfafc8a@example.com', password=**** (truncated)...]
14:57:17.991 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:17.991 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/moderator errors=[Пароль обязателен]
14:57:17.992 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:17.992 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@173c96b3]
14:57:17.993 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'password': rejected value []; codes [NotBlank.registerDto.password,NotBlank.password,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.password,password]; arguments []; default message [password]]; default message [Пароль обязателен]] ]
14:57:18.058 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/users/-1
14:57:18.059 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/-1
14:57:18.059 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.059 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/users/-1
14:57:18.059 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#getUserById(long, HttpServletRequest)
14:57:18.060 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.060 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.065 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleConstraintViolation(ConstraintViolationException, HttpServletRequest)
14:57:18.078 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/-1 message: должно быть больше 0
14:57:18.078 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.078 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@28975517]
14:57:18.078 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.validation.ConstraintViolationException: getUserById.id: должно быть больше 0]
14:57:18.149 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.150 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.152 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.154 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/99999/promote
14:57:18.154 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999/promote
14:57:18.154 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.154 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/99999/promote
14:57:18.155 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#promoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.155 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.155 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.156 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.157 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.158 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:18.160 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:18.174 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999/promote message: Запрошенный ресурс не найден
14:57:18.176 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.176 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@2741036b]
14:57:18.176 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:18.241 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/administrator
14:57:18.241 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/administrator
14:57:18.241 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.241 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/administrator
14:57:18.241 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createAdmin(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:18.242 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='', email='af146c73-403c-4922-afb0-264d6bfc9abc@example.com', password=****}]
14:57:18.242 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:18.242 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=admin@example.com path=/api/admin/users/create/administrator errors=[Имя пользователя не может быть пустым]
14:57:18.242 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.242 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7a94bb8d]
14:57:18.243 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.UserDto>> com.example.expensetracker.controller.AdminController.createAdmin(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'registerDto' on field 'name': rejected value []; codes [NotBlank.registerDto.name,NotBlank.name,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.name,name]; arguments []; default message [name]]; default message [Имя пользователя не может быть пустым]] ]
14:57:18.309 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.310 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.311 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.313 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/99999/demote
14:57:18.313 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999/demote
14:57:18.313 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.313 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/99999/demote
14:57:18.313 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#demoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.313 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.313 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.314 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.315 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.316 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:18.318 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:18.330 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999/demote message: Запрошенный ресурс не найден
14:57:18.330 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.330 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7357064e]
14:57:18.331 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:18.394 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.396 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.396 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.398 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.399 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.401 [main] DEBUG o.s.security.web.FilterChainProxy - Securing DELETE /api/admin/users/14/delete
14:57:18.401 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/14/delete
14:57:18.401 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.401 [main] DEBUG o.s.security.web.FilterChainProxy - Secured DELETE /api/admin/users/14/delete
14:57:18.402 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#deleteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.402 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.402 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.403 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.404 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.405 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:18.407 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:18.412 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:18.415 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:18.415 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@444f4258]
14:57:18.429 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:18.482 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.483 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.484 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.486 [main] DEBUG o.s.security.web.FilterChainProxy - Securing DELETE /api/admin/users/15/delete
14:57:18.486 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/15/delete
14:57:18.486 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.486 [main] DEBUG o.s.security.web.FilterChainProxy - Secured DELETE /api/admin/users/15/delete
14:57:18.486 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#deleteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.486 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.486 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.487 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.488 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.489 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleIllegalArgument(IllegalArgumentException, HttpServletRequest)
14:57:18.501 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/15/delete message: Некорректный запрос
14:57:18.501 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.501 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5ca5624d]
14:57:18.502 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.IllegalArgumentException: Нельзя выполнить действие над самим собой]
14:57:18.567 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.568 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.569 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.571 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/admin/users/create/moderator
14:57:18.571 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/create/moderator
14:57:18.571 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.571 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/admin/users/create/moderator
14:57:18.571 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#createModer(RegisterDto, UserDetailsImpl, HttpServletRequest)
14:57:18.572 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='newAdmin', email='a0a56f70-118c-40ff-b646-3d82fac8f03c@example.com', password=**** (truncated)...]
14:57:18.572 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.572 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.createModer(com.example.expensetracker.dto.RegisterDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.573 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.574 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.576 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:18.622 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.624 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:18.625 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.627 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.628 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:18.629 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@449f1226]
14:57:18.646 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:18.700 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.702 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.703 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.705 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.706 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.706 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.709 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/19/promote
14:57:18.709 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/19/promote
14:57:18.709 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.709 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/19/promote
14:57:18.709 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#promoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.709 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.710 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.711 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.712 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.713 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:18.715 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:18.715 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@44ba085c]
14:57:18.780 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.782 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.784 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/users
14:57:18.784 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users
14:57:18.784 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.784 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/users
14:57:18.784 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#getAllUsers(Pageable, HttpServletRequest)
14:57:18.786 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getAllUsers(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.787 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getAllUsers(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.789 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) order by u1_0.id offset ? rows fetch first ? rows only
14:57:18.790 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.793 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:18.794 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@42226e7b]
14:57:18.796 [main] WARN  o.s.d.w.c.SpringDataJacksonConfiguration$PageModule$WarningLoggingModifier - Serializing PageImpl instances as-is is not supported, meaning that there is no guarantee about the stability of the resulting JSON structure!
	For a stable JSON structure, please use Spring Data's PagedModel (globally via @EnableSpringDataWebSupport(pageSerializationMode = VIA_DTO))
	or Spring HATEOAS and Spring Data's PagedResourcesAssembler as documented in https://docs.spring.io/spring-data/commons/reference/repositories/core-extensions.html#core.web.pageables.

14:57:18.871 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:18.873 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.873 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:18.875 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/99999/unban
14:57:18.876 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999/unban
14:57:18.876 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:18.876 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/99999/unban
14:57:18.876 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#unbanUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:18.877 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.877 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:18.878 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:18.879 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:18.880 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:18.881 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:18.894 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999/unban message: Запрошенный ресурс не найден
14:57:18.894 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:18.894 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@521763ff]
14:57:18.894 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:19.007 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.008 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.009 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.011 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.012 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.014 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/23/demote
14:57:19.014 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/23/demote
14:57:19.014 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.015 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/23/demote
14:57:19.015 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#demoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:19.015 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.015 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.demoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.016 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:19.017 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:19.018 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.020 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.020 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3e6ab69a]
14:57:19.091 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.093 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.094 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.095 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.096 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.098 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/25/ban
14:57:19.098 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/25/ban
14:57:19.099 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.099 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/25/ban
14:57:19.099 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:19.100 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.100 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.101 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:19.102 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:19.103 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.104 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:19.106 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:19.109 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.109 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@4416091b]
14:57:19.124 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:19.126 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.180 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.181 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.183 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/users/26
14:57:19.183 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/26
14:57:19.183 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.183 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/users/26
14:57:19.183 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#getUserById(long, HttpServletRequest)
14:57:19.184 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.184 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.getUserById(long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.184 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.186 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.186 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@373d1692]
14:57:19.252 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.253 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.254 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.256 [main] DEBUG o.s.security.web.FilterChainProxy - Securing DELETE /api/admin/users/99999/delete
14:57:19.256 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/99999/delete
14:57:19.256 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.256 [main] DEBUG o.s.security.web.FilterChainProxy - Secured DELETE /api/admin/users/99999/delete
14:57:19.256 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#deleteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:19.256 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.256 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.deleteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.258 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:19.259 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:19.259 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.261 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:19.274 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: admin@example.com path: /api/admin/users/99999/delete message: Запрошенный ресурс не найден
14:57:19.274 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:19.274 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5a59b52e]
14:57:19.274 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:19.347 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.348 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.349 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.351 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.352 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.355 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.357 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:19.359 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/29/unban
14:57:19.359 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/29/unban
14:57:19.359 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.359 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/29/unban
14:57:19.359 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#unbanUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:19.360 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.360 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.361 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:19.362 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:19.363 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.364 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:19.366 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:19.368 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.368 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7aad55c1]
14:57:19.385 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:19.387 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.441 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.442 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.443 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.445 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.446 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.447 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/admin/users/31/promote
14:57:19.448 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/users/31/promote
14:57:19.448 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.448 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/admin/users/31/promote
14:57:19.448 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AdminController#promoteUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:19.448 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.448 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AdminController.promoteUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AdminController]
14:57:19.450 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:19.451 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:19.451 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.452 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:19.456 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.458 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.458 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3eaa4472]
14:57:19.532 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/logs
14:57:19.532 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/logs
14:57:19.532 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.532 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/logs
14:57:19.532 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AppLogController#getAllLogs(Pageable, HttpServletRequest)
14:57:19.533 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AppLogController.getAllLogs(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AppLogController]
14:57:19.533 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AppLogController.getAllLogs(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AppLogController]
14:57:19.632 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.632 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@15150b5a]
14:57:19.708 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/logs/user/admin@example.com
14:57:19.708 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/logs/user/admin@example.com
14:57:19.708 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.708 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/logs/user/admin@example.com
14:57:19.708 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AppLogController#getByUser(String, Pageable, HttpServletRequest)
14:57:19.710 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AppLogController.getByUser(java.lang.String,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AppLogController]
14:57:19.710 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AppLogController.getByUser(java.lang.String,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AppLogController]
14:57:19.730 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.730 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@62632f2a]
14:57:19.812 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:19.814 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false)
14:57:19.817 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.818 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.820 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.821 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.823 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:19.826 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/audit
14:57:19.826 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/audit
14:57:19.826 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.827 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/audit
14:57:19.827 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuditController#getAllAudit(Pageable, HttpServletRequest)
14:57:19.827 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getAllAudit(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:19.827 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getAllAudit(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:19.828 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0 order by a1_0.time_stamp desc offset ? rows fetch first ? rows only
14:57:19.830 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.831 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.832 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.832 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@38d47ad9]
14:57:19.899 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:19.900 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false)
14:57:19.902 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.903 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.905 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.906 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.907 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:19.910 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/audit/34
14:57:19.910 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/audit/34
14:57:19.910 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:19.911 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/audit/34
14:57:19.911 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuditController#getByAdmin(Long, Pageable, HttpServletRequest)
14:57:19.911 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getByAdmin(java.lang.Long,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:19.911 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getByAdmin(java.lang.Long,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:19.914 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0 left join users pb1_0 on pb1_0.id=a1_0.performed_by and (pb1_0.deleted = false) where pb1_0.id=? order by a1_0.time_stamp desc fetch first ? rows only
14:57:19.915 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.916 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:19.917 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:19.917 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@2c4d0706]
14:57:19.984 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:19.985 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false)
14:57:19.988 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.989 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.991 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:19.992 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:19.994 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:20.110 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:20.113 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/audit
14:57:20.113 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/audit
14:57:20.113 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.113 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/audit
14:57:20.113 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuditController#getAllAudit(Pageable, HttpServletRequest)
14:57:20.114 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getAllAudit(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:20.114 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getAllAudit(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:20.115 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0 order by a1_0.time_stamp desc offset ? rows fetch first ? rows only
14:57:20.117 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:20.117 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:20.118 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:20.118 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@33a3b5b3]
14:57:20.192 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:20.194 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false)
14:57:20.197 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:20.198 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:20.200 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:20.201 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:20.203 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:20.311 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:20.314 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/admin/audit/38
14:57:20.314 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/admin/audit/38
14:57:20.314 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.314 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/admin/audit/38
14:57:20.314 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuditController#getByAdmin(Long, Pageable, HttpServletRequest)
14:57:20.314 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getByAdmin(java.lang.Long,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:20.314 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.AuditController.getByAdmin(java.lang.Long,org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.AuditController]
14:57:20.315 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0 left join users pb1_0 on pb1_0.id=a1_0.performed_by and (pb1_0.deleted = false) where pb1_0.id=? order by a1_0.time_stamp desc fetch first ? rows only
14:57:20.316 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:20.317 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:20.318 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:20.318 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@36a7308]
14:57:20.396 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:20.396 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:20.396 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.397 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.397 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:20.397 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:20.397 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='ffc09191-8d36-4a42-b60b-a9534a0a31ae', email='test-b293ef0c-75a2-4ade-a1bc-75c8961 (truncated)...]
14:57:20.398 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка регистрации: test-b293ef0c-75a2-4ade-a1bc-75c8961e7f46@example.com
14:57:20.398 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:20.446 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:20.447 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:20.449 [main] INFO  c.e.e.service.AuthServiceImpl - Успешная регистрация: test-b293ef0c-75a2-4ade-a1bc-75c8961e7f46@example.com
14:57:20.453 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:20.453 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.model.User@28]
14:57:20.490 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:20.491 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:20.493 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:20.494 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:20.496 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан refresh-токен для test-b293ef0c-75a2-4ade-a1bc-75c8961e7f46@example.com
14:57:20.542 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/refresh
14:57:20.542 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/refresh
14:57:20.542 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.542 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.542 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/refresh
14:57:20.542 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#refresh(RefreshRequest)
14:57:20.545 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RefreshRequest[refreshToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LWIyOTNlZjBjLTc1YTItNGFkZS1hMWJjLTc (truncated)...]
14:57:20.546 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка обновления токена
14:57:20.546 [main] INFO  c.e.expensetracker.security.JwtUtil - Анализ токена
14:57:20.565 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:20.566 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:20.567 [main] WARN  c.e.e.service.AuthServiceImpl - Неудачная попытка обновления токена, пользователь test-b293ef0c-75a2-4ade-a1bc-75c8961e7f46@example.com заблокирован
14:57:20.567 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleAccessDenied(AccessDeniedException, HttpServletRequest)
14:57:20.581 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/refresh message: Отказано в доступе
14:57:20.582 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:20.582 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5fa2d418]
14:57:20.582 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.access.AccessDeniedException: Ваш аккаунт заблокирован]
14:57:20.648 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:20.648 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:20.648 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.648 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.648 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:20.648 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:20.649 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='e812f066-5e05-46b4-b251-f20c638ece70', email='test-60aee46c-409d-48f2-bfca-6006f97 (truncated)...]
14:57:20.649 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка регистрации: test-60aee46c-409d-48f2-bfca-6006f97cd89d@example.com
14:57:20.650 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:20.697 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:20.698 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:20.700 [main] INFO  c.e.e.service.AuthServiceImpl - Успешная регистрация: test-60aee46c-409d-48f2-bfca-6006f97cd89d@example.com
14:57:20.700 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:20.700 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.model.User@29]
14:57:20.715 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/login
14:57:20.715 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/login
14:57:20.715 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.715 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.715 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/login
14:57:20.715 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#login(LoginRequest)
14:57:20.716 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [LoginRequest[email=test-60aee46c-409d-48f2-bfca-6006f97cd89d@example.com, password=invalidPassword]]
14:57:20.717 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка авторизации: test-60aee46c-409d-48f2-bfca-6006f97cd89d@example.com
14:57:20.718 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:20.719 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:20.766 [main] WARN  c.e.e.service.AuthServiceImpl - Авторизация провалилась: не верный пароль для почты test-60aee46c-409d-48f2-bfca-6006f97cd89d@example.com
14:57:20.766 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleBadCredentials(BadCredentialsException, HttpServletRequest)
14:57:20.781 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/login message: Неверные учётные данные
14:57:20.782 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:20.782 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@25491cd1]
14:57:20.782 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.authentication.BadCredentialsException: Неверный пароль]
14:57:20.849 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/login
14:57:20.849 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/login
14:57:20.849 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.849 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.849 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/login
14:57:20.850 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#login(LoginRequest)
14:57:20.850 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [LoginRequest[email=test-d0844e8b-209b-41fa-b2fc-9bb749e2a580@example.com, password=123]]
14:57:20.850 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка авторизации: test-d0844e8b-209b-41fa-b2fc-9bb749e2a580@example.com
14:57:20.851 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:20.852 [main] WARN  c.e.e.service.AuthServiceImpl - Авторизация провалилась: почта test-d0844e8b-209b-41fa-b2fc-9bb749e2a580@example.com не найдена
14:57:20.852 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleBadCredentials(BadCredentialsException, HttpServletRequest)
14:57:20.865 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/login message: Неверные учётные данные
14:57:20.865 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:20.865 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@4d3715f7]
14:57:20.865 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.authentication.BadCredentialsException: Неверная почта]
14:57:20.931 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан refresh-токен для test-4fc2ae6e-82f0-4929-b17d-dde03c193946@example.com
14:57:20.931 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/refresh
14:57:20.932 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/refresh
14:57:20.932 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:20.932 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:20.932 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/refresh
14:57:20.932 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#refresh(RefreshRequest)
14:57:20.932 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RefreshRequest[refreshToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LTRmYzJhZTZlLTgyZjAtNDkyOS1iMTdkLWR (truncated)...]
14:57:20.932 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка обновления токена
14:57:20.932 [main] INFO  c.e.expensetracker.security.JwtUtil - Анализ токена
14:57:20.933 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:20.934 [main] WARN  c.e.e.service.AuthServiceImpl - Неудачная попытка обновления токена, пользователь test-4fc2ae6e-82f0-4929-b17d-dde03c193946@example.com не найден
14:57:20.934 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleUsernameNotFound(UsernameNotFoundException, HttpServletRequest)
14:57:20.947 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/refresh message: Пользователь не найден
14:57:20.948 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:20.948 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5c424a5c]
14:57:20.948 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.core.userdetails.UsernameNotFoundException: Пользователь не найден]
14:57:21.018 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:21.018 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:21.018 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.018 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.018 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:21.018 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:21.019 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='User', email='test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com', password=*** (truncated)...]
14:57:21.020 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка регистрации: test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.020 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:21.067 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.069 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.071 [main] INFO  c.e.e.service.AuthServiceImpl - Успешная регистрация: test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.071 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.071 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.model.User@2a]
14:57:21.085 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/login
14:57:21.085 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/login
14:57:21.085 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.085 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.085 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/login
14:57:21.085 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#login(LoginRequest)
14:57:21.086 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [LoginRequest[email=test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com, password=123]]
14:57:21.086 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка авторизации: test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.086 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.087 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.135 [main] INFO  c.e.e.service.AuthServiceImpl - Успешная авторизация: test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.135 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан access-токен для test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.135 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан refresh-токен для test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.137 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.137 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [TokenResponse[accessToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LTM4OTM3ZmY0LTVjN2YtNDI0YS04MmRiLWIyM (truncated)...]
14:57:21.161 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/refresh
14:57:21.161 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/refresh
14:57:21.161 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.161 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.161 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/refresh
14:57:21.161 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#refresh(RefreshRequest)
14:57:21.161 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RefreshRequest[refreshToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LTM4OTM3ZmY0LTVjN2YtNDI0YS04MmRiLWI (truncated)...]
14:57:21.161 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка обновления токена
14:57:21.161 [main] INFO  c.e.expensetracker.security.JwtUtil - Анализ токена
14:57:21.162 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.163 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.163 [main] INFO  c.e.e.service.AuthServiceImpl - Успешное обновление токена, пользователя test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.163 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан access-токен для test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.164 [main] INFO  c.e.expensetracker.security.JwtUtil - Создан refresh-токен для test-38937ff4-5c7f-424a-82db-b2354fd6faa8@example.com
14:57:21.164 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.164 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [TokenResponse[accessToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0LTM4OTM3ZmY0LTVjN2YtNDI0YS04MmRiLWIyM (truncated)...]
14:57:21.235 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/refresh
14:57:21.235 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/refresh
14:57:21.235 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.235 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.235 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/refresh
14:57:21.235 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#refresh(RefreshRequest)
14:57:21.236 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RefreshRequest[refreshToken=invalidToken]]
14:57:21.236 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка обновления токена
14:57:21.236 [main] INFO  c.e.expensetracker.security.JwtUtil - Анализ токена
14:57:21.236 [main] ERROR c.e.e.service.AuthServiceImpl - Ошибка обновление токена, пользователя Invalid compact JWT string: Compact JWSs must contain exactly 2 period characters, and compact JWEs must contain exactly 4.  Found: 0
io.jsonwebtoken.MalformedJwtException: Invalid compact JWT string: Compact JWSs must contain exactly 2 period characters, and compact JWEs must contain exactly 4.  Found: 0
	at io.jsonwebtoken.impl.JwtTokenizer.tokenize(JwtTokenizer.java:102)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:370)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:362)
	at io.jsonwebtoken.impl.DefaultJwtParser.parse(DefaultJwtParser.java:94)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:36)
	at io.jsonwebtoken.impl.io.AbstractParser.parse(AbstractParser.java:29)
	at io.jsonwebtoken.impl.DefaultJwtParser.parseSignedClaims(DefaultJwtParser.java:821)
	at com.example.expensetracker.security.JwtUtil.parse(JwtUtil.java:63)
	at com.example.expensetracker.service.AuthServiceImpl.refresh(AuthServiceImpl.java:81)
	at com.example.expensetracker.controller.AuthController.refresh(AuthController.java:26)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at com.example.expensetracker.logging.applog.AppLogFilter.doFilterInternal(AppLogFilter.java:30)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:101)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:125)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:119)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.example.expensetracker.security.JwtAuthFilter.doFilterInternal(JwtAuthFilter.java:50)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.ServletRequestPathFilter.doFilter(ServletRequestPathFilter.java:52)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebSecurityConfiguration.java:319)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$4(HandlerMappingIntrospector.java:267)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:240)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:362)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:278)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:162)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at test.controller.AuthControllerIT.refresh_shouldReturnUnauthorized_whenTokenInvalid(AuthControllerIT.java:157)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:775)
	at org.junit.platform.commons.support.ReflectionSupport.invokeMethod(ReflectionSupport.java:479)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:161)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:152)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:91)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:112)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:94)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:87)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:216)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:212)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:137)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:156)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:160)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:146)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:144)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:143)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:100)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:201)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:170)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:94)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:59)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:142)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.junit.platform.launcher.core.InterceptingLauncher.lambda$execute$1(InterceptingLauncher.java:39)
	at org.junit.platform.launcher.core.ClasspathAlignmentCheckingLauncherInterceptor.intercept(ClasspathAlignmentCheckingLauncherInterceptor.java:25)
	at org.junit.platform.launcher.core.InterceptingLauncher.execute(InterceptingLauncher.java:38)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
14:57:21.238 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleBadCredentials(BadCredentialsException, HttpServletRequest)
14:57:21.252 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/refresh message: Неверные учётные данные
14:57:21.252 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.252 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@657c1e8f]
14:57:21.252 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.authentication.BadCredentialsException: Невалидный токен]
14:57:21.319 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:21.319 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:21.319 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.319 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.319 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:21.319 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:21.320 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='User', email='test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com', password=*** (truncated)...]
14:57:21.320 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка регистрации: test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com
14:57:21.321 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:21.368 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.369 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.371 [main] INFO  c.e.e.service.AuthServiceImpl - Успешная регистрация: test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com
14:57:21.371 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.371 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.model.User@2b]
14:57:21.385 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:21.385 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:21.385 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.385 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.385 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:21.385 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:21.386 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='User', email='test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com', password=*** (truncated)...]
14:57:21.386 [main] DEBUG c.e.e.service.AuthServiceImpl - Попытка регистрации: test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com
14:57:21.387 [main] DEBUG org.hibernate.SQL - select u1_0.id from users u1_0 where (u1_0.deleted = false) and u1_0.email=? fetch first ? rows only
14:57:21.387 [main] WARN  c.e.e.service.AuthServiceImpl - Регистрации провалилась: почта test-d6d5b8b3-9a87-4cc5-b763-7145e5f12a36@example.com уже используется
14:57:21.388 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleDataIntegrityViolation(DataIntegrityViolationException, HttpServletRequest)
14:57:21.401 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: anonymous path: /api/auth/register message: Нарушение ограничений базы данных
14:57:21.401 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.401 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@652f2cf3]
14:57:21.401 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.dao.DataIntegrityViolationException: Эта почта уже используется]
14:57:21.473 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/auth/register
14:57:21.473 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/auth/register
14:57:21.473 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.473 [main] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
14:57:21.473 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/auth/register
14:57:21.473 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.AuthController#register(RegisterDto)
14:57:21.474 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RegisterDto{name='User', email='', password=****}]
14:57:21.474 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:21.474 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=anonymous path=/api/auth/register errors=[Почта обязательна]
14:57:21.474 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.474 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@9e3491e]
14:57:21.475 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.model.User> com.example.expensetracker.controller.AuthController.register(com.example.expensetracker.dto.RegisterDto): [Field error in object 'registerDto' on field 'email': rejected value []; codes [NotBlank.registerDto.email,NotBlank.email,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [registerDto.email,email]; arguments []; default message [email]]; default message [Почта обязательна]] ]
14:57:21.550 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.551 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.553 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.554 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.555 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/expenses/report
14:57:21.555 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/expenses/report
14:57:21.556 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.556 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/expenses/report
14:57:21.556 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ExpenseController#report(DateRangeDto, UserDetailsImpl, HttpServletRequest)
14:57:21.573 [main] DEBUG org.hibernate.SQL - select coalesce(c1_0.name,'UNCATEGORIZED'),sum(e1_0.amount) from expenses e1_0 left join categories c1_0 on c1_0.id=e1_0.category_id where e1_0.user_id=? and e1_0.occurred_at between ? and ? group by c1_0.name
14:57:21.580 [main] DEBUG org.hibernate.SQL - select coalesce(sum(e1_0.amount),0) from expenses e1_0 where e1_0.user_id=? and e1_0.occurred_at between ? and ?
14:57:21.581 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.581 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@2ace6e2e]
14:57:21.656 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.658 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.660 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.661 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.662 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/expenses/total
14:57:21.662 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/expenses/total
14:57:21.662 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.663 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/expenses/total
14:57:21.663 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ExpenseController#getTotal(UserDetailsImpl, HttpServletRequest)
14:57:21.666 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:21.668 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:21.668 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@3544dc5b]
14:57:21.737 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.738 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.740 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.741 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.742 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/expenses/report
14:57:21.742 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/expenses/report
14:57:21.742 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.742 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/expenses/report
14:57:21.743 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ExpenseController#report(DateRangeDto, UserDetailsImpl, HttpServletRequest)
14:57:21.744 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:21.744 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/expenses/report errors=[from должен быть раньше to]
14:57:21.744 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.744 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@69446998]
14:57:21.744 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.ExpensesReportDto>> com.example.expensetracker.controller.ExpenseController.report(com.example.expensetracker.dto.DateRangeDto,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'dateRangeDto' on field 'validRange': rejected value [false]; codes [AssertTrue.dateRangeDto.validRange,AssertTrue.validRange,AssertTrue.boolean,AssertTrue]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [dateRangeDto.validRange,validRange]; arguments []; default message [validRange]]; default message [from должен быть раньше to]] ]
14:57:21.814 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.815 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.816 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.818 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.819 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.820 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.821 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.822 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.824 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/48/ban
14:57:21.824 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/48/ban
14:57:21.824 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.824 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/48/ban
14:57:21.824 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:21.824 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:21.824 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:21.827 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.827 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.828 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:21.830 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleAccessDenied(AccessDeniedException, HttpServletRequest)
14:57:21.843 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/48/ban message: Отказано в доступе
14:57:21.843 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.843 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@780c43ee]
14:57:21.843 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.access.AccessDeniedException: Отказано в доступе]
14:57:21.908 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.909 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.910 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.912 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.913 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.914 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:21.916 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.916 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:21.918 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/50/ban
14:57:21.918 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/50/ban
14:57:21.918 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:21.918 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/50/ban
14:57:21.918 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:21.919 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:21.919 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:21.919 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:21.920 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:21.921 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:21.922 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleAccessDenied(AccessDeniedException, HttpServletRequest)
14:57:21.937 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/50/ban message: Отказано в доступе
14:57:21.938 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:21.938 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@130e0105]
14:57:21.938 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.access.AccessDeniedException: Отказано в доступе]
14:57:22.009 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.010 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.011 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.014 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.015 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.016 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/51/ban
14:57:22.016 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/51/ban
14:57:22.016 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.016 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/51/ban
14:57:22.016 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:22.016 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.016 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.017 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.018 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.019 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleIllegalArgument(IllegalArgumentException, HttpServletRequest)
14:57:22.034 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/51/ban message: Некорректный запрос
14:57:22.034 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.034 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7513c10c]
14:57:22.034 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.IllegalArgumentException: Нельзя выполнить действие над самим собой]
14:57:22.112 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.114 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.115 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.118 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.119 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.120 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/99999/ban
14:57:22.120 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/99999/ban
14:57:22.120 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.120 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/99999/ban
14:57:22.120 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:22.121 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.121 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.121 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.122 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.123 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.125 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:22.137 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/99999/ban message: Запрошенный ресурс не найден
14:57:22.137 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.138 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@27e42673]
14:57:22.138 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:22.205 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.206 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.207 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.210 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.210 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.212 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/moderator/users/99999
14:57:22.212 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/99999
14:57:22.212 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.212 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/moderator/users/99999
14:57:22.212 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#getUserById(Long, HttpServletRequest)
14:57:22.212 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.213 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.213 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.215 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleUserNotFoundById(UserNotFoundByIdException, HttpServletRequest)
14:57:22.228 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/99999 message: Пользователь не найден
14:57:22.228 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.228 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@322e40bb]
14:57:22.228 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [com.example.expensetracker.exception.UserNotFoundByIdException: Пользователь с ID 99999 не найден]
14:57:22.296 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.297 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.298 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.300 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.301 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.302 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/moderator/users/-1
14:57:22.302 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/-1
14:57:22.302 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.302 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/moderator/users/-1
14:57:22.303 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#getUserById(Long, HttpServletRequest)
14:57:22.303 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.303 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.303 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleConstraintViolation(ConstraintViolationException, HttpServletRequest)
14:57:22.316 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/-1 message: должно быть больше 0
14:57:22.316 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.316 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@75c42f51]
14:57:22.316 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.validation.ConstraintViolationException: getUserById.id: должно быть больше 0]
14:57:22.396 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.398 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.398 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.401 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.401 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.402 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.403 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.405 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/moderator/users
14:57:22.405 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users
14:57:22.405 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.405 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/moderator/users
14:57:22.405 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#getAllUsers(Pageable, HttpServletRequest)
14:57:22.406 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getAllUsers(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.406 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getAllUsers(org.springframework.data.domain.Pageable,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.407 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) order by u1_0.id offset ? rows fetch first ? rows only
14:57:22.408 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.409 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.410 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:22.410 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@46d5cf61]
14:57:22.479 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.481 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.481 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.484 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.484 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.485 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/99999/unban
14:57:22.485 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/99999/unban
14:57:22.485 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.485 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/99999/unban
14:57:22.486 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#unbanUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:22.486 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.486 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.486 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.487 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.488 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.490 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleEntityNotFound(EntityNotFoundException, HttpServletRequest)
14:57:22.502 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: moderator@example.com path: /api/moderator/users/99999/unban message: Запрошенный ресурс не найден
14:57:22.502 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.502 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5f585409]
14:57:22.503 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [jakarta.persistence.EntityNotFoundException: Пользователь не найден]
14:57:22.571 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.572 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.573 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.576 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.576 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.577 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.578 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.580 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/59/ban
14:57:22.580 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/59/ban
14:57:22.580 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.580 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/59/ban
14:57:22.580 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#banUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:22.581 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.581 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.banUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.581 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.582 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.583 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.584 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:22.585 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:22.587 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:22.587 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@4867282c]
14:57:22.602 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:22.604 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.657 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.658 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.658 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.661 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.661 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.662 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.663 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.665 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/moderator/users/61
14:57:22.665 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/61
14:57:22.665 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.665 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/moderator/users/61
14:57:22.665 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#getUserById(Long, HttpServletRequest)
14:57:22.665 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.666 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.getUserById(java.lang.Long,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.666 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.667 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:22.667 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7c3fa7a0]
14:57:22.730 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.731 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.731 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.734 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.735 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.735 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.736 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.738 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.739 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:22.741 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/moderator/users/63/unban
14:57:22.741 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/moderator/users/63/unban
14:57:22.741 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.741 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/moderator/users/63/unban
14:57:22.741 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.ModeratorController#unbanUser(Long, UserDetailsImpl, HttpServletRequest)
14:57:22.741 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.742 [main] DEBUG o.s.s.a.m.AuthorizationManagerBeforeMethodInterceptor - Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.expensetracker.controller.ModeratorController.unbanUser(java.lang.Long,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest); target is of class [com.example.expensetracker.controller.ModeratorController]
14:57:22.742 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.743 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.743 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.744 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:22.746 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:22.747 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:22.747 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5f2f8782]
14:57:22.760 [main] DEBUG org.hibernate.SQL - select a1_0.id,a1_0.action,a1_0.performed_by,a1_0.target_user_id,a1_0.time_stamp from admin_audit a1_0
14:57:22.762 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:22.815 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.816 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.819 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.820 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.821 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/recurring-transaction
14:57:22.821 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction
14:57:22.821 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.821 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/recurring-transaction
14:57:22.822 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#getAll(UserDetails, HttpServletRequest)
14:57:22.823 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.824 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.825 [main] DEBUG org.hibernate.SQL - select rt1_0.id,rt1_0.active,rt1_0.amount,rt1_0.category_id,rt1_0.description,rt1_0.interval_days,rt1_0.next_execution_date,rt1_0.user_id from recurring_transactions rt1_0 left join users u1_0 on u1_0.id=rt1_0.user_id and (u1_0.deleted = false) where u1_0.email=?
14:57:22.826 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:22.826 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@49fd546e]
14:57:22.891 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.892 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.895 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.896 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.897 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:22.900 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PATCH /api/recurring-transaction/99999/toggle
14:57:22.900 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/99999/toggle
14:57:22.900 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.900 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PATCH /api/recurring-transaction/99999/toggle
14:57:22.900 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#toggleActive(Long, HttpServletRequest)
14:57:22.901 [main] DEBUG org.hibernate.SQL - select rt1_0.id,rt1_0.active,rt1_0.amount,rt1_0.category_id,rt1_0.description,rt1_0.interval_days,rt1_0.next_execution_date,rt1_0.user_id from recurring_transactions rt1_0 where rt1_0.id=?
14:57:22.902 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleIllegalArgument(IllegalArgumentException, HttpServletRequest)
14:57:22.914 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: user@example.com path: /api/recurring-transaction/99999/toggle message: Некорректный запрос
14:57:22.914 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.914 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@70427755]
14:57:22.915 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.IllegalArgumentException: Recurring transaction not found]
14:57:22.979 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:22.980 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:22.983 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:22.984 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:22.985 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:22.988 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:22.988 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:22.988 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:22.988 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:22.988 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:22.991 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=description, categoryId=2, intervalDays=0]]
14:57:22.995 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:22.995 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/recurring-transaction/create errors=[должно быть не меньше 1]
14:57:22.996 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:22.996 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@49574df]
14:57:22.996 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.RecurringTransactionDto>> com.example.expensetracker.controller.RecurringTransactionController.create(org.springframework.security.core.userdetails.UserDetails,com.example.expensetracker.dto.RecurringTransactionRequestDto,jakarta.servlet.http.HttpServletRequest): [Field error in object 'recurringTransactionRequestDto' on field 'intervalDays': rejected value [0]; codes [Min.recurringTransactionRequestDto.intervalDays,Min.intervalDays,Min.int,Min]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [recurringTransactionRequestDto.intervalDays,intervalDays]; arguments []; default message [intervalDays],1]; default message [должно быть не меньше 1]] ]
14:57:23.060 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.061 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.064 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.065 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.065 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.068 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.068 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.068 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.068 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.068 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.068 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=, categoryId=3, intervalDays=30]]
14:57:23.069 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.069 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/recurring-transaction/create errors=[Описание не может быть пустым]
14:57:23.069 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.069 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7c137062]
14:57:23.069 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.RecurringTransactionDto>> com.example.expensetracker.controller.RecurringTransactionController.create(org.springframework.security.core.userdetails.UserDetails,com.example.expensetracker.dto.RecurringTransactionRequestDto,jakarta.servlet.http.HttpServletRequest): [Field error in object 'recurringTransactionRequestDto' on field 'description': rejected value []; codes [NotBlank.recurringTransactionRequestDto.description,NotBlank.description,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [recurringTransactionRequestDto.description,description]; arguments []; default message [description]]; default message [Описание не может быть пустым]] ]
14:57:23.139 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.140 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.143 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.144 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.145 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.145 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.145 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.145 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.145 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.145 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=description, categoryId=99999, intervalDays=3 (truncated)...]
14:57:23.146 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.147 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.148 [main] DEBUG org.hibernate.SQL - select c1_0.id,c1_0.name from categories c1_0 where c1_0.id=?
14:57:23.149 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleIllegalArgument(IllegalArgumentException, HttpServletRequest)
14:57:23.165 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: user@example.com path: /api/recurring-transaction/create message: Некорректный запрос
14:57:23.166 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.166 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5485d7c8]
14:57:23.166 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [java.lang.IllegalArgumentException: Category not found]
14:57:23.235 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.236 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.239 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.240 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.241 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.243 [main] DEBUG org.hibernate.SQL - insert into recurring_transactions (active,amount,category_id,description,interval_days,next_execution_date,user_id) values (?,?,?,?,?,?,?)
14:57:23.247 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/recurring-transaction
14:57:23.247 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction
14:57:23.247 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.247 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/recurring-transaction
14:57:23.247 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#getAll(UserDetails, HttpServletRequest)
14:57:23.248 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.248 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.249 [main] DEBUG org.hibernate.SQL - select rt1_0.id,rt1_0.active,rt1_0.amount,rt1_0.category_id,rt1_0.description,rt1_0.interval_days,rt1_0.next_execution_date,rt1_0.user_id from recurring_transactions rt1_0 left join users u1_0 on u1_0.id=rt1_0.user_id and (u1_0.deleted = false) where u1_0.email=?
14:57:23.250 [main] DEBUG org.hibernate.SQL - select c1_0.id,c1_0.name from categories c1_0 where c1_0.id=?
14:57:23.252 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:23.252 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5e7673e9]
14:57:23.317 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.318 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.321 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.321 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.322 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.324 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.324 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.324 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.324 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.324 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.325 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=-500, description=description, categoryId=5, intervalDays=30]]
14:57:23.325 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.325 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/recurring-transaction/create errors=[Количество не может быть меньше нуля]
14:57:23.325 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.325 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7523e933]
14:57:23.326 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.RecurringTransactionDto>> com.example.expensetracker.controller.RecurringTransactionController.create(org.springframework.security.core.userdetails.UserDetails,com.example.expensetracker.dto.RecurringTransactionRequestDto,jakarta.servlet.http.HttpServletRequest): [Field error in object 'recurringTransactionRequestDto' on field 'amount': rejected value [-500]; codes [Positive.recurringTransactionRequestDto.amount,Positive.amount,Positive.java.math.BigDecimal,Positive]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [recurringTransactionRequestDto.amount,amount]; arguments []; default message [amount]]; default message [Количество не может быть меньше нуля]] ]
14:57:23.388 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.389 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.392 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.392 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.393 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.395 [main] DEBUG org.hibernate.SQL - insert into recurring_transactions (active,amount,category_id,description,interval_days,next_execution_date,user_id) values (?,?,?,?,?,?,?)
14:57:23.397 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PATCH /api/recurring-transaction/2/toggle
14:57:23.397 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/2/toggle
14:57:23.397 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.397 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PATCH /api/recurring-transaction/2/toggle
14:57:23.398 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#toggleActive(Long, HttpServletRequest)
14:57:23.398 [main] DEBUG org.hibernate.SQL - select rt1_0.id,rt1_0.active,rt1_0.amount,rt1_0.category_id,rt1_0.description,rt1_0.interval_days,rt1_0.next_execution_date,rt1_0.user_id from recurring_transactions rt1_0 where rt1_0.id=?
14:57:23.400 [main] DEBUG org.hibernate.SQL - select c1_0.id,c1_0.name from categories c1_0 where c1_0.id=?
14:57:23.400 [main] DEBUG org.hibernate.SQL - update recurring_transactions set active=?,amount=?,category_id=?,description=?,interval_days=?,next_execution_date=?,user_id=? where id=?
14:57:23.402 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:23.402 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7336831e]
14:57:23.414 [main] DEBUG org.hibernate.SQL - select rt1_0.id,rt1_0.active,rt1_0.amount,rt1_0.category_id,rt1_0.description,rt1_0.interval_days,rt1_0.next_execution_date,rt1_0.user_id from recurring_transactions rt1_0 where rt1_0.id=?
14:57:23.465 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.466 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.469 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.469 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.470 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.473 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.473 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.473 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.473 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.473 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.473 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=null, categoryId=7, intervalDays=30]]
14:57:23.474 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.474 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/recurring-transaction/create errors=[Описание не может быть пустым]
14:57:23.474 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.474 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@480f3065]
14:57:23.474 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.RecurringTransactionDto>> com.example.expensetracker.controller.RecurringTransactionController.create(org.springframework.security.core.userdetails.UserDetails,com.example.expensetracker.dto.RecurringTransactionRequestDto,jakarta.servlet.http.HttpServletRequest): [Field error in object 'recurringTransactionRequestDto' on field 'description': rejected value [null]; codes [NotBlank.recurringTransactionRequestDto.description,NotBlank.description,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [recurringTransactionRequestDto.description,description]; arguments []; default message [description]]; default message [Описание не может быть пустым]] ]
14:57:23.536 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.536 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.539 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.540 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.541 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.541 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.541 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.541 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.541 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.541 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=description, categoryId=null, intervalDays=30 (truncated)...]
14:57:23.541 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.541 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/recurring-transaction/create errors=[Id категории обязательно]
14:57:23.541 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.541 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@6b9bf1d5]
14:57:23.542 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [1] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<com.example.expensetracker.dto.RecurringTransactionDto>> com.example.expensetracker.controller.RecurringTransactionController.create(org.springframework.security.core.userdetails.UserDetails,com.example.expensetracker.dto.RecurringTransactionRequestDto,jakarta.servlet.http.HttpServletRequest): [Field error in object 'recurringTransactionRequestDto' on field 'categoryId': rejected value [null]; codes [NotNull.recurringTransactionRequestDto.categoryId,NotNull.categoryId,NotNull.java.lang.Long,NotNull]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [recurringTransactionRequestDto.categoryId,categoryId]; arguments []; default message [categoryId]]; default message [Id категории обязательно]] ]
14:57:23.603 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.604 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.607 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.608 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.609 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:23.613 [main] DEBUG org.hibernate.SQL - delete from user_roles where user_id=?
14:57:23.614 [main] DEBUG org.hibernate.SQL - delete from users where id=?
14:57:23.618 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.620 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.620 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.620 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.620 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.620 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.621 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=description, categoryId=8, intervalDays=30]]
14:57:23.621 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.623 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleUserNotFoundById(UserNotFoundByIdException, HttpServletRequest)
14:57:23.635 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: user@example.com path: /api/recurring-transaction/create message: Пользователь не найден
14:57:23.635 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.635 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@2217c640]
14:57:23.635 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [com.example.expensetracker.exception.UserNotFoundByIdException: User not found]
14:57:23.699 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.700 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.703 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.703 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.704 [main] DEBUG org.hibernate.SQL - insert into categories (name) values (?)
14:57:23.706 [main] DEBUG o.s.security.web.FilterChainProxy - Securing POST /api/recurring-transaction/create
14:57:23.706 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/recurring-transaction/create
14:57:23.706 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.706 [main] DEBUG o.s.security.web.FilterChainProxy - Secured POST /api/recurring-transaction/create
14:57:23.707 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.RecurringTransactionController#create(UserDetails, RecurringTransactionRequestDto, HttpServletRequest)
14:57:23.707 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [RecurringTransactionRequestDto[amount=500, description=description, categoryId=9, intervalDays=30]]
14:57:23.707 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.708 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.709 [main] DEBUG org.hibernate.SQL - select c1_0.id,c1_0.name from categories c1_0 where c1_0.id=?
14:57:23.709 [main] DEBUG org.hibernate.SQL - insert into recurring_transactions (active,amount,category_id,description,interval_days,next_execution_date,user_id) values (?,?,?,?,?,?,?)
14:57:23.712 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:23.712 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@7f822835]
14:57:23.788 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.789 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.838 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:23.839 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:23.842 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/users/change-password
14:57:23.842 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/change-password
14:57:23.842 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.842 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/users/change-password
14:57:23.843 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#changePassword(ChangePasswordRequest, UserDetailsImpl, HttpServletRequest)
14:57:23.844 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChangePasswordRequest[oldPassword=123, newPassword=]]
14:57:23.845 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.845 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/users/change-password errors=[Введите новый пароль]
14:57:23.845 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.845 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@4629ea1f]
14:57:23.845 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<java.lang.String>> com.example.expensetracker.controller.UserController.changePassword(com.example.expensetracker.dto.ChangePasswordRequest,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'changePasswordRequest' on field 'newPassword': rejected value []; codes [NotBlank.changePasswordRequest.newPassword,NotBlank.newPassword,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [changePasswordRequest.newPassword,newPassword]; arguments []; default message [newPassword]]; default message [Введите новый пароль]] ]
14:57:23.910 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.911 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.914 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/users/change-password
14:57:23.914 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/change-password
14:57:23.914 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.914 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/users/change-password
14:57:23.914 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#changePassword(ChangePasswordRequest, UserDetailsImpl, HttpServletRequest)
14:57:23.914 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChangePasswordRequest[oldPassword=, newPassword=newPass]]
14:57:23.914 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleMethodArgumentNotValid(MethodArgumentNotValidException, HttpServletRequest)
14:57:23.914 [main] WARN  c.e.e.e.GlobalExceptionHandler - Validation error: user=user@example.com path=/api/users/change-password errors=[Введите старый пароль]
14:57:23.914 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:23.914 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@27604047]
14:57:23.915 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.example.expensetracker.dto.ApiResponse<java.lang.String>> com.example.expensetracker.controller.UserController.changePassword(com.example.expensetracker.dto.ChangePasswordRequest,com.example.expensetracker.details.UserDetailsImpl,jakarta.servlet.http.HttpServletRequest): [Field error in object 'changePasswordRequest' on field 'oldPassword': rejected value []; codes [NotBlank.changePasswordRequest.oldPassword,NotBlank.oldPassword,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [changePasswordRequest.oldPassword,oldPassword]; arguments []; default message [oldPassword]]; default message [Введите старый пароль]] ]
14:57:23.977 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:23.978 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.979 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:23.981 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/users/me
14:57:23.981 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/me
14:57:23.981 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:23.981 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/users/me
14:57:23.981 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#getCurrentUser(UserDetailsImpl, HttpServletRequest)
14:57:23.983 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:23.983 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:23.984 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:23.984 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@294416ff]
14:57:24.046 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:24.047 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:24.049 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/users/me
14:57:24.049 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/me
14:57:24.049 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:24.049 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/users/me
14:57:24.049 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#getCurrentUser(UserDetailsImpl, HttpServletRequest)
14:57:24.051 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:24.051 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:24.052 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:24.052 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@1a9e7ba7]
14:57:24.113 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/users/me
14:57:24.113 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/me
14:57:24.113 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:24.113 [main] WARN  c.e.e.security.JwtAuthFilter - Отсутствует токен - пользователь не аутентифицирован
14:57:24.164 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:24.165 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:24.212 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:24.214 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:24.216 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/users/change-password
14:57:24.216 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/change-password
14:57:24.216 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:24.216 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/users/change-password
14:57:24.216 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#changePassword(ChangePasswordRequest, UserDetailsImpl, HttpServletRequest)
14:57:24.216 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChangePasswordRequest[oldPassword=invalidPassword, newPassword=newPass]]
14:57:24.217 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:24.218 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:24.266 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Using @ExceptionHandler com.example.expensetracker.exception.GlobalExceptionHandler#handleBadCredentials(BadCredentialsException, HttpServletRequest)
14:57:24.279 [main] WARN  c.e.e.e.GlobalExceptionHandler - GlobalExceptionHandler: user: user@example.com path: /api/users/change-password message: Неверные учётные данные
14:57:24.279 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
14:57:24.279 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@60f4131]
14:57:24.279 [main] DEBUG o.s.w.s.m.m.a.ExceptionHandlerExceptionResolver - Resolved [org.springframework.security.authentication.BadCredentialsException: Неверный старый пароль]
14:57:24.351 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:24.352 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:24.400 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,r1_0.user_id,r1_0.role,u1_0.total_expenses from users u1_0 left join user_roles r1_0 on u1_0.id=r1_0.user_id where u1_0.id=? and (u1_0.deleted = false)
14:57:24.401 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:24.403 [main] DEBUG o.s.security.web.FilterChainProxy - Securing PUT /api/users/change-password
14:57:24.403 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/change-password
14:57:24.403 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:24.404 [main] DEBUG o.s.security.web.FilterChainProxy - Secured PUT /api/users/change-password
14:57:24.404 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#changePassword(ChangePasswordRequest, UserDetailsImpl, HttpServletRequest)
14:57:24.404 [main] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [ChangePasswordRequest[oldPassword=123, newPassword=newPass]]
14:57:24.405 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:24.406 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:24.498 [main] DEBUG org.hibernate.SQL - insert into admin_audit (action,performed_by,target_user_id,time_stamp) values (?,?,?,?)
14:57:24.500 [main] DEBUG org.hibernate.SQL - update users set banned=?,deleted=?,email=?,password=?,total_expenses=? where id=?
14:57:24.502 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:24.502 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@5907b08b]
14:57:24.564 [main] DEBUG org.hibernate.SQL - insert into users (banned,deleted,email,password,total_expenses) values (?,?,?,?,?)
14:57:24.565 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:24.565 [main] DEBUG org.hibernate.SQL - insert into user_roles (user_id,role) values (?,?)
14:57:24.568 [main] DEBUG o.s.security.web.FilterChainProxy - Securing GET /api/users/me
14:57:24.568 [main] INFO  c.e.e.security.JwtAuthFilter - Мы внутри фильтра! URI: /api/users/me
14:57:24.568 [main] INFO  c.e.e.security.JwtAuthFilter - Заголовок входящей авторизации: null
14:57:24.568 [main] DEBUG o.s.security.web.FilterChainProxy - Secured GET /api/users/me
14:57:24.568 [main] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.example.expensetracker.controller.UserController#getCurrentUser(UserDetailsImpl, HttpServletRequest)
14:57:24.569 [main] DEBUG org.hibernate.SQL - select u1_0.id,u1_0.banned,u1_0.deleted,u1_0.email,u1_0.password,u1_0.total_expenses from users u1_0 where (u1_0.deleted = false) and u1_0.email=?
14:57:24.570 [main] DEBUG org.hibernate.SQL - select r1_0.user_id,r1_0.role from user_roles r1_0 where r1_0.user_id=?
14:57:24.570 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json, application/yaml]
14:57:24.570 [main] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [com.example.expensetracker.dto.ApiResponse@682fd9b6]
14:57:24.590 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
14:57:24.697 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
14:57:24.726 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
14:57:24.728 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
14:57:24.729 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
